[{"content":"外网打点\n三板斧\n开了三个端口 22，443，8080\n有域名扫子域名无果\n扫目录\n现在要么就是看不了要么就是要登录，看8080端口\n在一个历史版本里找到了用户密码\n登录了之前扫401的目录\n看/manger/status/all看不到管理界面\n看一下html的但是跳到nginx了。。。（这不是tomcat吗？）\n之后搜了下这是用nginx反向代理了tomcat\n之后看了其他大佬的wp\n这里存在一个目录穿越\n大体就是tomcat会将/..;/解析成传统意义上的/../，而nginx不会。所以nginx放过了本该拦截的URL访问，这样我们就能进入控制台了。\n1 2 3 Web servers and reverse proxies normalize the request path. For example, the path /image/../image/ is normalized to /images/ . When Apache Tomcat is used together with a reverse proxy such as nginx there is a nromalization inconsistency. Tomcat will threat the sequence /..;/ as /../ and normalize the path while reverse proxies will not normalize this sequence and send it to Apache Tomcat as it is. This allows an attacker to access Apache Tomcat resources that are not normally accessible via the reverse proxy mapping. /manger/status/..;/html进入到管理后台\n看到可以上传war文件上传一个🐎拿到shell\n权限提升 找了半天找到一个run.yml\n1 2 3 4 5 6 7 8 9 10 11 12 - hosts: localhost tasks: - name: Copy Files synchronize: src=/var/lib/tomcat9/webapps/ROOT/admin/dashboard dest=/opt/backups/files copy_links=yes - name: Server Backups archive: path: /opt/backups/files/ dest: \u0026#34;/opt/backups/archives/backup-{{ansible_date_time.date}}-{{ansible_date_time.time}}.gz\u0026#34; - name: Clean file: state: absent path: /opt/backups/files/ 代码解释\nsynchronize模块：其功能是把源目录/var/lib/tomcat9/webapps/ROOT/admin/dashboard复制到目标目录/opt/backups/files，并且复制符号链接。\narchive模块：将/opt/backups/files/目录打包成一个压缩文件，文件名包含当前日期和时间，存于/opt/backups/archives/目录下。\nfile模块：把/opt/backups/files/目录删除。\n开启了copy_links，我们可以把一些好东西连接到/var/lib/tomcat9/webapps/ROOT/admin/dashboard目录下，然后让这个进程打包，之后我们再解压拿到东西\n正好我们有在/var/lib/tomcat9/webapps/ROOT/admin/dashboard/uploads下写的权限\n1 ln -s /home/luis/.ssh/ /var/lib/tomcat9/webapps/ROOT/admin/dashboard/uploads/id_rsa 然后等待我们的id_rsa\nssh登录拿到user.txt\n","date":"2025-03-19T14:05:44+08:00","permalink":"https://example.com/htb/seal/","title":"Seal"},{"content":"","date":"2025-03-13T11:49:13+08:00","permalink":"https://example.com/htb/test/","title":"Test"},{"content":"外网打点 扫端口，有域名扫子域名，扫目录\n打开网址\n界面可以上传网址然后通过curl拿到网址的信息\n有个后台域名admin.forge.htb\n后台域名限制了本地ip访问（常规绕过也不管用）\n所以思路就是制造ssrf攻击\n测试admin.forge.htb\n有黑名单\n双大写绕过ADMIN.FORGE.htb\n从这里得知upload可以用ftp协议\nhttp://ADMIN.FORGE.htb/upload?u=ftp://user:heightofsecurity123!@127.0.1.1/\n有用，之后拿/.ssh/id_rsa\n拿到user.txt\n提权 linpeas.sh扫pwnkit\n上传脚本提权成功\n","date":"2025-03-12T17:28:02+08:00","permalink":"https://example.com/htb/forge/","title":"Forge1"}]